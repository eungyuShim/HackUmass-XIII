<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>Grade Planner — Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="../css/global.css"/>
  <link rel="stylesheet" href="../css/dashboard.css"/>
</head>
<body>
<div class="layout">
  <!-- 사이드바 -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1>Grade<br>Planner</h1>
      <p>Academic planning made easy</p>
    </div>
    <nav>
      <ul class="nav-list">
        <li class="nav-item">
          <a href="course.html" class="nav-link">
            ← Back to Courses
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link active">
            Dashboard
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- 메인 콘텐츠 -->
  <div class="main-content">
    <header class="header">
      <div>
        <div style="font-size:13px;color:var(--txt-muted);margin-bottom:4px">Current Course</div>
        <h2 id="course">Course Name</h2>
        <div class="grade-select-hint">Select a target letter grade to see required strategy:</div>
        <div class="grade-options" id="gradeOptions">
          <button class="grade-btn" data-grade="A">A</button>
          <button class="grade-btn" data-grade="A-">A-</button>
          <button class="grade-btn" data-grade="B+">B+</button>
          <button class="grade-btn" data-grade="B">B</button>
          <button class="grade-btn" data-grade="B-">B-</button>
          <button class="grade-btn" data-grade="C+">C+</button>
          <button class="grade-btn" data-grade="C">C</button>
          <button class="grade-btn" data-grade="C-">C-</button>
        </div>
      </div>
      <!-- Updated header button to open setup modal -->
      <button class="upload-btn" id="openSetupBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
        </svg>
        Course Setup
      </button>
    </header>

    <div class="wrap">
      <!-- New two-step setup modal (Syllabus Upload + AI Analysis) -->
      <div id="setupModal" class="modal-overlay" style="display:none">
        <div class="modal-content setup-modal">
          <!-- Step 1: Syllabus Upload -->
          <div id="step1" class="setup-step">
            <h3 style="margin-bottom:16px;font-size:24px;color:var(--txt)">Step 1: Upload Your Syllabus</h3>
            <p style="color:var(--txt-muted);line-height:1.7;margin-bottom:24px">
              Upload your course syllabus (PDF) and our AI will extract important information including grading weights, drop policies, exam counts, extra credit opportunities, and assignment details.
            </p>
            
            <div class="upload-area" id="uploadSyllabusArea">
              <img src="../icons/file-upload.svg" alt="upload" class="upload-icon"/>
              <div class="upload-text">Click to upload syllabus</div>
              <div class="upload-hint">PDF, DOC, DOCX files supported</div>
            </div>
            <input type="file" id="syllabusFileUpload" accept=".pdf,.doc,.docx" style="display:none">
            <div id="uploadStatus" style="margin-top:16px;color:var(--txt-muted);font-size:14px"></div>
            
            <div class="row" style="justify-content:flex-end;margin-top:24px">
              <button class="btn btn--ghost" id="cancelSetupBtn">Cancel</button>
              <button class="btn btn--ghost" id="skipUploadBtn">Skip Upload</button>
              <button id="proceedBtn" class="btn btn--primary" disabled>Continue to Analysis</button>
            </div>
          </div>

          <!-- Step 2: AI Analysis Configuration -->
          <div id="step2" class="setup-step" style="display:none">
            <h3 style="margin-bottom:16px;font-size:24px;color:var(--txt)">Step 2: Configure Grade Weights</h3>
            <p style="color:var(--txt-muted);line-height:1.7;margin-bottom:24px">
              Review the extracted information from your syllabus. You can modify any values below before confirming and proceeding to your dashboard.
            </p>

            <!-- Replaced fixed weight inputs with dynamic category management -->
            <div class="analysis-card">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                <h4 style="margin:0">Grade Categories</h4>
                <button class="btn btn-small btn--secondary" id="addSetupCategoryBtn">+ Add</button>
              </div>
              <div id="setupCategoriesList" style="display:flex;flex-direction:column;gap:12px"></div>
              <div style="margin-top:12px;padding:8px;background:var(--bg-gray);border-radius:6px;font-size:13px">
                <b>Total:</b> <span id="setupTotalWeight">0</span>% 
                <span id="setupWeightWarning" style="color:#dc2626;display:none">Must equal 100%</span>
              </div>
            </div>

            <div class="row" style="justify-content:flex-end;margin-top:32px">
              <button class="btn btn--ghost" id="backToUploadBtn">← Back</button>
              <button class="btn btn--primary" id="confirmSetupBtn">Confirm & Apply Settings</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Improved progress bar -->
      <div class="card">
        <h3>Grade Range Projection</h3>
        <div class="progress-container">
          <!-- Added target grade pin marker with position relative container -->
          <div class="progress-bar-wrapper">
            <div class="progress-bar-bg">
              <div class="progress-bar-fill" id="maxFill" style="width:0%"></div>
            </div>
            <div class="progress-pin" id="targetPin" style="display:flex;left:93%">
              <div class="progress-pin-label" id="targetPinLabel" title="A ≥ 93%">A</div>
              <img src="../icons/pin.svg" alt="target" class="progress-pin-icon">
            </div>
          <div class="progress-label">
            <span class="progress-label-text">Maximum Possible Grade</span>
            <span class="progress-label-value" id="maxVal">0%</span>
          </div>
          </div>
        </div>
      </div>

      <!-- Target strategy with individual assignment sliders -->
      <div class="card" id="targetStrategy" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
          <h3 id="strategyTitle" style="margin:0;">Strategy for A</h3>
          <div style="text-align:right;">
            <div style="font-size:13px;color:var(--txt-muted);margin-bottom:2px;">Projected Grade</div>
            <div id="projectedGrade" style="font-size:24px;font-weight:700;color:var(--accent);">93.0%</div>
          </div>
        </div>
        <div id="ungradedItemsList" style="display:flex;flex-direction:column;gap:12px">
          <!-- Individual sliders will be rendered here -->
        </div>
      </div>

      <!-- Template for ungraded item slider (hidden) -->
      <template id="ungradedItemTemplate">
        <div class="ungraded-item-slider">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <div style="display:flex;align-items:center;">
              <div>
                <div class="item-name" style="font-weight:600;font-size:14px;color:var(--txt)"></div>
                <div class="item-category" style="font-size:12px;color:var(--txt-muted)"></div>
              </div>
              <button class="pin-btn" type="button"
                      style="cursor:pointer;margin-left:8px;background:none;border:none;padding:6px 8px;
                             display:inline-flex;align-items:center;transition:opacity 0.2s;">
                <img src="../icons/pin-fill.svg" alt="pin" style="width:20px;height:20px;">
              </button>
            </div>
            <input type="number" class="slider-value-input" min="0" max="100" 
                   step="0.1" 
                   style="width:60px;text-align:center;font-size:17px;
                   font-weight:700;color:var(--accent);border:none;
                   border-radius:4px;padding:2px 4px;background:transparent;outline:none;">
          </div>
          <input type="range" class="target-slider" min="0" max="100" step="0.1">
        </div>
      </template>

      <!-- 카테고리 관리 섹션 -->
      <div class="card">
        <div class="row space-between" style="margin-bottom:24px">
          <h3 style="margin:0">Grade Categories</h3>
          <button class="btn btn--primary btn-small" id="addCategoryBtn">+ Add Category</button>
        </div>
        
        <div id="categoriesList" class="category-grid"></div>
        
        <div style="margin-top:16px;padding:12px;background:var(--bg-gray);border-radius:8px;font-size:14px;color:var(--txt-muted)">
          <b>Total Weight:</b> <span id="totalWeight">0</span>% 
          <span id="weightWarning" style="color:#dc2626;display:none">Must equal 100%</span>
        </div>
      </div>

      <!-- Current Grade Summary -->
      <div class="card">
        <details>
          <summary style="cursor:pointer;font-weight:600;padding:8px 0">View Current Grade Summary</summary>
          <div style="margin-top:24px;overflow-x:auto">
            <table style="width:100%;border-collapse:collapse">
              <thead>
                <tr style="border-bottom:2px solid var(--border-light)">
                  <th style="text-align:left;padding:12px;font-weight:600">Category</th>
                  <th style="text-align:left;padding:12px;font-weight:600">Current Average</th>
                  <th style="text-align:left;padding:12px;font-weight:600">Weight (%)</th>
                  
                </tr>
              </thead>
              <tbody id="sumBody"></tbody>
            </table>
          </div>
        </details>
      </div>
    </div>
  </div>
</div>

<script src="../js/storage.js" defer></script>
<script src="../js/categories.js" defer></script>
<script src="../js/progress.js" defer></script>
<script src="../js/setup.js" defer></script>
<script src="../js/events.js" defer></script>
<script src="../js/bootstrap.js" defer></script>
</body>
</html>
